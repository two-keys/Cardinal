<% if defined?(locals) && locals[:reporting] %>
  <% prompt = locals[:reportable] %>
<% end %>
<div id="<%= dom_id prompt %>" class="card primary prompt">
  <div class="prompt_info">
    <%= render partial: 'directory/metainfo', locals: { model: prompt} %>
    <div class="tags">
      <%= render partial: 'prompts/tags', locals: { prompt: prompt} %>
    </div>
    <span class="slots">
      <strong><u><%= prompt.default_slots %></u> SLOTS</strong>
    </span>
    <span class="managed">
      <strong><% unless prompt.managed? %>UN-<% end %>MANAGED</strong>
    </span>
  </div>

  <% if prompt.ooc.present? %>
    <div data-controller="read-more" data-read-more-more-text-value="Read more" data-read-more-less-text-value="Read less">
      <div class="ooc truncate truncate--line-clamped" data-read-more-target="content">
        <div data-read-more-target="inner">
          <%= prompt.mark_ooc %>
        </div>
      </div>

      <button data-action="read-more#toggle" data-read-more-target="button" class="hide fullwidth">More...</button>
    </div>
  <% end %>

  <% if prompt.ooc.present? && prompt.starter.present? %>
    <hr />
  <% end %>

  <% if prompt.starter.present? %>
    <div data-controller="read-more" data-read-more-more-text-value="Read more" data-read-more-less-text-value="Read less">
      <div class="starter truncate truncate--line-clamped" data-read-more-target="content">
        <div data-read-more-target="inner">
          <%= prompt.mark_starter %>
        </div>
      </div>

      <button data-read-more-target="button" data-action="read-more#toggle" class="hide fullwidth">More...</button>
    </div>
  <% end %>

  <% if can? :edit, prompt %>
    <span>
      <%= link_to "History", history_prompt_path(prompt), class: "prompt_history_link" %>
      <%= link_to "Edit", edit_prompt_path(prompt), class: "prompt_edit_link" %>
    </span>
  <% end %>

  <ul class="prompt_actions">
    <li><%= link_to "Report", new_report_path(reportable_id: prompt.id, reportable_type: prompt.class.name), class: "report_link" %></li>
    <% if can?(:edit, prompt) && prompt.bumpable? %>
      <li><%= button_to "Bump", prompt_bump_path(prompt), method: :put %></li>
    <% end %>
    <% if can?(:answer, prompt) %>
      <li><%= button_to "Answer", prompt_answer_path(prompt), method: :post %></li>
    <% end %>
  </ul>
</div>
<% if defined?(locals) && !locals[:reporting] %>
  <% @chats.each do |chat| %>
      <% connect_code = chat.connect_code %>
      <div class="card secondary">
        <%= link_to 'No title set', chat_path(chat.uuid) %>
        <hr />
        <p><strong>CONNECT CODE</strong> <%= connect_code.code %></p>
        <p><strong>OPEN SLOTS <u><%= connect_code.remaining_uses %></u></strong></p>
        <% if false && connect_code.description.present? %>
          <%= connect_code.description %>
        <% else %>
          <i>No description set.</i>
        <% end %>
      </div>
    <% end %>
<% end %>